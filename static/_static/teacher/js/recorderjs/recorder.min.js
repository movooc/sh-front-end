!function(t){var e=function(t,e){var o,r=e||{},a=r.bufferLen||4096;o=r.workerPath?r.workerPath+"?t="+Date.parse(new Date):"static/_static/teacher/js/recorderjs/recorderWorker.js",this.context=t.context,this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(a,2,2):this.node=this.context.createJavaScriptNode(a,2,2);var n=new Worker(o);n.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:1,path:r.workerPath?r.workerPath.replace(/(.*)\/[\w\.]+$/,"$1/lame.min.js?t="+Date.parse(new Date)):"/static/_static/teacher/js/recorderjs/lame.js"}});var s,c=!1;this.node.onaudioprocess=function(t){c&&n.postMessage({command:"record",buffer:[t.inputBuffer.getChannelData(0)]})},this.configure=function(t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])},this.record=function(){c=!0},this.stop=function(){c=!1},this.clear=function(){n.postMessage({command:"clear"})},this.terminate=function(){n.terminate()},this.getBuffers=function(t){s=t||r.callback,n.postMessage({command:"getBuffers"})},this.exportWAV=function(t,e){if(s=t||r.callback,e=e||r.type||"audio/wav",!s)throw new Error("Callback not set");n.postMessage({command:"exportWAV",type:e})},this.exportMonoWAV=function(t,e){if(s=t||r.callback,e=e||r.type||"audio/wav",!s)throw new Error("Callback not set");n.postMessage({command:"exportMonoWAV",type:e})},this.exportMP3=function(t){if(!(s=t||r.callback))throw new Error("Callback not set");n.postMessage({command:"exportMP3",type:"audio/mp3"})},this.Uint8ArrayToFloat32Array=function(t){for(var e=new Float32Array(t.length),o=0;o<t.length;o++){var r=t[o<<1]+(t[1+(o<<1)]<<8);r>=32768&&(r|=-32768),e[o]=r/32768}return e},this.parseWav=function(t){var e=function(e,o){for(var r=0,a=0;o;)r+=t[e]<<a,a+=8,e++,o--;return r};if(1!=e(20,2))throw"Invalid compression code, not PCM";if(1!=e(22,2))throw"Invalid number of channels, not 1";return{sampleRate:e(24,4),bitsPerSample:e(34,2),samples:t.subarray(44)}},n.onmessage=function(t){var e=t.data;s(e)},t.connect(this.node),this.node.connect(this.context.destination)};e.setupDownload=function(e,o){var r=(t.URL||t.webkitURL).createObjectURL(e),a=document.getElementById("save");a.href=r,a.download=o||"output.wav"},t.Recorder=e}(window);